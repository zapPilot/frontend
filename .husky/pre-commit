#!/bin/sh
set -euo pipefail

# Pre-commit quality gates (optimized for fail-fast)
# Run fastest/most-likely-to-fail checks first to save developer time

echo "ğŸ” Running quality gates..."

# Phase 1: Fast static analysis (15s total)
echo "\nğŸ“‹ Phase 1: Static Analysis"
npm run type-check           # ~10s - TypeScript errors (most common)
npm run deadcode:check       # ~5s  - Unused exports (now fails properly)

# Phase 2: Code quality checks (13s total)
echo "\nğŸ¨ Phase 2: Code Quality"
npx lint-staged             # ~2s  - Format & lint staged files
npm run lint                # ~8s  - Full lint (complexity thresholds)
npm run dup:all            # ~3s  - Duplicate code detection

# Phase 3: Comprehensive testing (60s+)
echo "\nğŸ§ª Phase 3: Testing"
npm run test:safeall       # ~60s - Full test suite + coverage

echo "\nâœ… All quality gates passed!"
